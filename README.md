# PayPwn Capture The Flag

## Background

This capture the flag consists of 4 fake websites. The websites mimic PayPal (PayBuddy), eBay (eBid), Facebook (Friendbook), and Hotmail (Coldmail). Content on these sites is periodically auto generated by ChatGPT and cached, thus making them seem like fully functioning sites with live user data. The objective is one that everyone is very familiar with, to get money. Auto generated users on the system have money, and you need to figure out how to make it yours.

### Solution (Spoilers)

The PayBuddy website has a customer support chat bot you can communicate with. You need to get access to a user's email, and collect enough information about that user to social engineer the chat bot into giving you access to their account. From there you will be able to transfer money from their account to one you created.

* Sign up for Coldmail, PayBuddy, and eBid accounts
* Redeem an eBid voucher that gives you $100 credit
    * Voucher redemption page links to developer docs that describe how the voucher codes are verified
    * Use PBKDFv2 with a combination of user's email and "100FREE" to generate a hex voucher code
* Purchase something from an eBid user
    * Receive an email with a generated image of the package that shows the sender's name and address
* Find the user on Friendbook
    * Use the documented REST API to query PII about the user (A la Cambridge Analytica)
    * REST API also leaks their bcrypt password hash
    * Use john the ripper (etc) with PII to crack their password (Ex "PetNameDOB!")
    * Friendbook account password also matches their Coldmail password
* Convince the PayBuddy chat bot you need a password reset
    * Provide the account username
    * Bypass OTP verification
        * Insist you are not getting the OTP, and chatbot will eventually concede there must be technical difficulties on their side
        * OR make up an excuse why you do not have access to your mobile device
        * OR convince the chat bot you did actually verify the OTP correctly
    * Verify PII questions from the chat bot
    * Receive a password reset link to their email
* Login to PayBuddy and transfer the money to your account
    * Bypass the OTP login which is checked client side (This was a real PayPal vulnerability once)

## Build

The NPM packages and protobuf definitions need to be compiled before the docker images can be created. This will require bash and docker buildkit on the host machine. Host assumes

```
./build/build.sh
```

Any changes to the NPM packages.json or python requirements.txt will require running this build script again.

## Run

The built containers can be run with docker compose. This will result in port 443 (prod) and 8443 (devserver) to be exposed to the host machine's interfaces.

```
docker compose up -d
```

If you do not want to expose the devserver port, you can ignore the dev docker compose override by using the following command instead.

```
docker compose -f docker-compose.yml up -d
```

## Development

### Dev server

Use port 8443 to see live updates to front-end changes

### Add npm package

You can add an npm package by using the build container

```
$ ./build/build.sh ash
$ cd paybuddy/vue/
$ npm install blah
```

### Load python changes

If you make a change to a python file, you can reload the running container with

```
docker compose restart paypwn
```

### Load Protobuf changes

You need to rerun the build script and restart the docker compose to load protobuf updates

```
./build/build.sh
docker compose down
docker compose up -d
```
